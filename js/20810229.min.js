const API="https://web1-api.herokuapp.com/api",AUTHENTICATE_API="https://web1-api.herokuapp.com/users",username="test",password="1c3cr3@m";async function loadData(request,templateId,viewId){const response=await fetch(`${API}/${request}`),data=await response.json();console.log(data);var template=Handlebars.templates[`${templateId}.hbs`],context={data:data},view;document.getElementById(viewId).innerHTML=template(context)}async function loadBlogs(request,currentPage,templateId,viewId){const response=await fetch(`${API}/${request}?page=${currentPage}`),context=await response.json();context.currentPage=currentPage;var template=Handlebars.templates["blogs-template.hbs"],view;document.getElementById(viewId).innerHTML=template(context)}async function loadBlogComments(blogId,templateId,viewId,gotoComment=!1){await loadData(`blogs/${blogId}`,templateId,viewId),checkLogin(),gotoComment&&(window.location.href="#comments")}async function addComment(e){e.preventDefault();let token=localStorage.getItem("token"),postData={name:document.getElementById("name").value,email:document.getElementById("email").value,comment:document.getElementById("comment").value,blogId:document.getElementById("blogId").value,agree:1==document.getElementById("agree").value},responseMessage=document.getElementById("responseMessage");try{let response=await fetch(`${AUTHENTICATE_API}/comment`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+token},body:JSON.stringify(postData)}),result=await response.json();if(200!=response.status)throw new Error(result.message);loadBlogComments(postData.blogId,"blog-details-template","blogs",!0)}catch(error){responseMessage.innerHTML=error,responseMessage.className="text-danger"}}async function getAuthenticateToken(_username,_password){let postData={username:_username,password:_password},response=await fetch(`${AUTHENTICATE_API}/authenticate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(postData)}),result=await response.json();if(console.log(result),200==response.status)return result.token;throw new Error(result.message)}async function login(event){event.preventDefault();let username=document.getElementById("username").value,password=document.getElementById("password").value;try{let token=await getAuthenticateToken(username,password);token&&(localStorage.setItem("token",token),document.getElementsByClassName("btn-close")[0].click(),displayControls())}catch(error){document.getElementById("errorMessage").innerHTML=error,displayControls(!1)}}function displayControls(isLogin=!0){let linkLogins=document.getElementsByClassName("linkLogin"),linkLogout=document.getElementsByClassName("linkLogout"),displayLogin="none",displayLogout="block";isLogin||(displayLogin="block",displayLogout="none");for(let i=0;i<2;i++)linkLogins[i].style.display=displayLogin,linkLogout[i].style.display=displayLogout;let leaveComment=document.getElementById("leave-comment");leaveComment&&(leaveComment.style.display=displayLogout)}async function checkLogin(){let isLogin;displayControls(await verifyToken())}async function verifyToken(){let token=localStorage.getItem("token");if(token){let response;if(200==(await fetch(`${AUTHENTICATE_API}/verify`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+token}})).status)return!0}return!1}function logout(){localStorage.clear(),displayControls(!1)}Handlebars.registerHelper("formatDate",(function(date){let formatDate,options={weekdays:"short",year:"numeric",month:"short",day:"numeric",timeZonename:"short"};return new Date(date).toLocaleDateString("en-US",options)}));